<?xml version="1.0" encoding="utf-8"?>
<project
	name="wepp.local"
	basedir="."
	default="deploy"
>

	<import file="build.xml" />

	<target name="deploy" depends="build">
		<property name="deploy.path" value="/home/lars-pub/local/htdocs/build/${project.name}/${project.version}" />

		<delete dir="${deploy.path}" />
		<copy todir="${deploy.path}">
			<fileset dir="${build.dir}" />
		</copy>
		<chmod file="${deploy.path}/wepp/bin/wepp" perm="ugo+x"/>
	</target>

	<target name="install" depends="build">
		<property name="install.path" value="/home/lars/env/node_modules/wepp" />
		<delete dir="${install.path}" />
		<mkdir dir="${install.path}" />
		<copy todir="${install.path}">
			<fileset dir="${build.dir}/wepp" />
		</copy>
		<chmod file="${install.path}/bin/wepp" perm="ugo+x"/>
		<!-- <symlink link="${install.path}/../.bin/wepp" resource="${install.path}/bin/wepp"/> -->
	</target>

	<target name="site" depends="release">
		<property name="site.path" value="../larsjung.de/src/htdocs" />
		<property name="project.path" value="${site.path}/release/${project.name}" />

		<!-- release -->
		<copy todir="${project.path}">
			<fileset dir="${release.dir}" includes="*.zip" />
		</copy>

		<!-- build -->
		<delete dir="${project.path}/${project.version}" />
		<copy todir="${project.path}/${project.version}">
			<fileset dir="${build.dir}" />
		</copy>
	</target>

	<target name="npm-publish" depends="build">
        <exec executable="npm" failonerror="true">
            <arg line="publish ${build.dir}/wepp" />
        </exec>
	</target>

</project>
